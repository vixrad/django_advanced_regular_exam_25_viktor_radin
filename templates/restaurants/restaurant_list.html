{% extends 'base.html' %}
{% load static %}
{% block content %}
<h1 class="mb-5 fw-bold text-center text-black">All Restaurants</h1>
<div class="row g-4">
    {% for restaurant in restaurants %}
    <div class="col-md-6 col-lg-4">
        <div class="card restaurant-card h-100 shadow-sm border-0">
            {% if restaurant.image %}
                <img src="{{ restaurant.image.url }}" class="card-img-top restaurant-img" alt="{{ restaurant.name }}">
            {% else %}
                <img src="{% static 'images/default-restaurant.png' %}" class="card-img-top restaurant-img" alt="Default restaurant image">
            {% endif %}

            <div class="card-body d-flex flex-column">
                <h2 class="restaurant-title text-center text-black">{{ restaurant.name }}</h2>
                <p class="restaurant-description text-center text-muted mb-4">
                    {{ restaurant.description|truncatewords:20 }}
                </p>

                <h3 class="section-heading text-black">📍 Address</h3>
                <p class="mb-3">
                    <a href="https://www.google.com/maps/search/?api=1&query={{ restaurant.street_name|urlencode }}+{{ restaurant.street_number|urlencode }}+{{ restaurant.city|urlencode }}+{{ restaurant.postal_code|urlencode }}"
                       target="_blank"
                       class="address-link">
                        {{ restaurant.street_name }} {{ restaurant.street_number }},
                        {{ restaurant.city }} {{ restaurant.postal_code }}
                    </a>
                </p>

                <h3 class="section-heading text-black">📞 Phone</h3>
                <p class="mb-4">
                    <a href="tel:{{ restaurant.phone|cut:' ' }}" class="phone-link">{{ restaurant.phone }}</a>
                </p>

                <h3 class="section-heading text-black">🕒 Opening Hours</h3>
                <ul class="list-unstyled opening-hours mb-4">
                    {% for day in restaurant.opening_hours.all %}
                        <li>
                            <strong class="text-black">{{ day.get_day_of_week_display }}</strong><br>
                            {% if day.is_closed %}
                                Closed
                            {% else %}
                                {{ day.open_time|time:"g:i A" }} – {{ day.close_time|time:"g:i A" }}
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>

                <div class="mt-auto d-flex flex-column gap-2">
                    <a href="{% url 'menu_detail' restaurant.id %}" class="btn btn-primary">View Menu</a>

                    {% if user.is_authenticated and user.is_owner and not user.is_superuser %}
                        <!-- Owners cannot book -->
                        <button class="btn btn-success" disabled title="Restaurant owners cannot book tables">
                            Book a Table
                        </button>
                    {% else %}
                        <!-- Normal users, superusers, and logged-out users -->
                        <a href="{% url 'reservation_create_with_restaurant' restaurant.id %}" class="btn btn-success">
                            Book a Table
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12 text-center">
        <p class="text-muted">No restaurants available at the moment.</p>
    </div>
    {% endfor %}
</div>
{% endblock %}